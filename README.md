# Magic Patterns - Vite Template

This code was generated by [Magic Patterns](https://magicpatterns.com) for this design: [Source Design](https://www.magicpatterns.com/c/45gkw7q4jdevzbl1ygpcxv)

## Getting Started

1. Run `npm install`
2. Run `npm run dev`

## Backend Flask (API)

Se añadió un backend mínimo en `api/` con Flask que expone:

- `GET /api/health` -> estado
- `GET /api/videos` -> lista archivos de video del directorio configurado (variable `VIDEO_DIR`, por defecto `/media/seguridad`).

Estructura backend:

```text
api/
	app.py        # create_app y rutas
	wsgi.py       # punto de entrada para gunicorn (wsgi:app)
	requirements.txt
```

Instalación backend (entorno virtual recomendado):

```bash
cd api
pip install -r requirements.txt
gunicorn --workers 2 --bind 127.0.0.1:5000 wsgi:app
```

Variable de entorno opcional:

```bash
export VIDEO_DIR=/media/seguridad
```

## Build Frontend con outDir personalizado

El `vite.config.ts` permite definir el directorio de salida con `BUILD_OUT_DIR`:

```bash
BUILD_OUT_DIR=/opt/app/camara/dist npm run build
```
Si no se define, usa `dist/` en el proyecto.

## NGINX ejemplo

```nginx
server {
	listen 80;
	server_name _;

	root /opt/app/camara/dist;
	index index.html;

	location /videos/ {
		alias /media/seguridad/; # archivos de video reales
		autoindex off;           # evitar listado automático
	}

	location /api/ {
		proxy_pass http://127.0.0.1:5000/api/;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
	}

	location / {
		try_files $uri /index.html;
	}
}
```

## systemd service (gunicorn)

Archivo `/etc/systemd/system/camara-api.service`:

```ini
[Unit]
Description=Camara Flask API
After=network.target

[Service]
WorkingDirectory=/opt/app/camara/api
Environment=VIDEO_DIR=/media/seguridad
ExecStart=/usr/bin/gunicorn --workers 2 --bind 127.0.0.1:5000 wsgi:app
Restart=on-failure
User=www-data
Group=www-data

[Install]
WantedBy=multi-user.target
```

Comandos:

```bash
systemctl daemon-reload
systemctl enable camara-api
systemctl start camara-api
```

## Flujo de despliegue

1. Construir frontend: `BUILD_OUT_DIR=/opt/app/camara/dist npm run build`
2. Instalar dependencias backend en el servidor y habilitar servicio systemd.
3. Configurar NGINX con el bloque mostrado y recargar: `nginx -s reload`.
4. Acceder a la aplicación en el navegador; la lista de videos se obtiene desde `/api/videos` y cada enlace apunta a `/videos/<archivo>`.

## Formato respuesta /api/videos

```json
{
	"videos": [
		{
			"name": "clip1.mp4",
			"size": 1048576,
			"mtime": "2025-08-31T10:15:22.123456+00:00",
			"url": "/videos/clip1.mp4"
		}
	],
	"count": 1
}
```

## UI

El componente `VideoClips` hace fetch a `/api/videos` y muestra nombre, fecha (local), tamaño formateado y enlace.

